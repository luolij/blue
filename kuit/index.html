<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>小米手环6连接器</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            width: 100%;
            max-width: 600px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        h1 {
            font-size: 28px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .device-info {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .info-row {
            display: flex;
            margin-bottom: 10px;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .info-label {
            font-weight: bold;
            width: 120px;
        }
        
        .info-value {
            flex: 1;
            word-break: break-all;
        }
        
        .status-container {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ff4757;
        }
        
        .status-dot.connected {
            background: #2ed573;
            animation: pulse 2s infinite;
        }
        
        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
        }
        
        button {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        
        button:active {
            transform: translateY(1px);
        }
        
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .log-container {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 15px;
            height: 150px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 14px;
        }
        
        .log-entry {
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .log-time {
            color: #a4b0be;
            margin-right: 10px;
        }
        
        .log-message {
            color: white;
        }
        
        .success {
            color: #2ed573;
        }
        
        .error {
            color: #ff4757;
        }
        
        .info {
            color: #70a1ff;
        }
        
        .scanning {
            animation: scanning 1.5s infinite;
        }
        
        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(46, 213, 115, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(46, 213, 115, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(46, 213, 115, 0);
            }
        }
        
        @keyframes scanning {
            0% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
            100% {
                opacity: 1;
            }
        }
        
        @media (max-width: 600px) {
            .container {
                padding: 20px;
            }
            
            h1 {
                font-size: 24px;
            }
            
            .controls {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M7 12L17 12" stroke="white" stroke-width="2" stroke-linecap="round"/>
                    <path d="M12 7L12 17" stroke="white" stroke-width="2" stroke-linecap="round"/>
                </svg>
                小米手环6连接器
            </h1>
            <p>扫描并连接您的Xiaomi Smart Band 6</p>
        </header>
        
        <div class="device-info">
            <div class="info-row">
                <div class="info-label">设备名称:</div>
                <div class="info-value">Xiaomi Smart Band 6</div>
            </div>
            <div class="info-row">
                <div class="info-label">MAC地址:</div>
                <div class="info-value">D8:FA:79:C6:56:1C</div>
            </div>
            <div class="info-row">
                <div class="info-label">设备类型:</div>
                <div class="info-value">智能手环</div>
            </div>
        </div>
        
        <div class="status-container">
            <div class="status-indicator">
                <div class="status-dot" id="statusDot"></div>
                <span id="statusText">未连接</span>
            </div>
            <div id="rssiValue">信号强度: --</div>
        </div>
        
        <div class="controls">
            <button id="scanButton">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M14 5C14 3.89543 13.1046 3 12 3C10.8954 3 10 3.89543 10 5M14 5C14 6.10457 13.1046 7 12 7C10.8954 7 10 6.10457 10 5M14 5H20M10 5H4M14 19C14 20.1046 13.1046 21 12 21C10.8954 21 10 20.1046 10 19M14 19C14 17.8954 13.1046 17 12 17C10.8954 17 10 17.8954 10 19M14 19H20M10 19H4M19 14V10M19 14C19 15.1046 19.8954 16 21 16C22.1046 16 23 15.1046 23 14C23 12.8954 22.1046 12 21 12C19.8954 12 19 12.8954 19 14ZM19 10C19 8.89543 19.8954 8 21 8C22.1046 8 23 8.89543 23 10C23 11.1046 22.1046 12 21 12C19.8954 12 19 11.1046 19 10ZM5 14V10M5 14C5 15.1046 4.10457 16 3 16C1.89543 16 1 15.1046 1 14C1 12.8954 1.89543 12 3 12C4.10457 12 5 12.8954 5 14ZM5 10C5 8.89543 4.10457 8 3 8C1.89543 8 1 8.89543 1 10C1 11.1046 1.89543 12 3 12C4.10457 12 5 11.1046 5 10Z" stroke="white" stroke-width="2" stroke-linecap="round"/>
                </svg>
                扫描设备
            </button>
            <button id="connectButton" disabled>
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M17 8H19C20.6569 8 22 9.34315 22 11V13C22 14.6569 20.6569 16 19 16H17M7 8H5C3.34315 8 2 9.34315 2 11V13C2 14.6569 3.34315 16 5 16H7M8 12H16M12 8V16" stroke="white" stroke-width="2" stroke-linecap="round"/>
                </svg>
                连接设备
            </button>
            <button id="disconnectButton" disabled>
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M18.364 5.63604C21.8787 9.15076 21.8787 14.8492 18.364 18.3639M5.63604 18.364C2.12132 14.8492 2.12132 9.15074 5.63604 5.63604M8.46447 15.5355C6.51184 13.5829 6.51184 10.4171 8.46447 8.46447M15.5355 8.46447C17.4882 10.4171 17.4882 13.5829 15.5355 15.5355M13 12C13 12.5523 12.5523 13 12 13C11.4477 13 11 12.5523 11 12C11 11.4477 11.4477 11 12 11C12.5523 11 13 11.4477 13 12Z" stroke="white" stroke-width="2" stroke-linecap="round"/>
                </svg>
                断开连接
            </button>
        </div>
        
        <div class="log-container" id="logContainer">
            <!-- 日志将在这里显示 -->
        </div>
    </div>

    <script>
        // 页面元素
        const scanButton = document.getElementById('scanButton');
        const connectButton = document.getElementById('connectButton');
        const disconnectButton = document.getElementById('disconnectButton');
        const statusDot = document.getElementById('statusDot');
        const statusText = document.getElementById('statusText');
        const rssiValue = document.getElementById('rssiValue');
        const logContainer = document.getElementById('logContainer');
        
        // 设备信息
        const deviceName = 'Xiaomi Smart Band 6';
        const deviceAddress = 'D8:FA:79:C6:56:1C';
        
        // 全局变量
        let selectedDevice = null;
        let isConnected = false;
        
        // 添加日志
        function addLog(message, type = 'info') {
            const now = new Date();
            const timeString = now.toTimeString().split(' ')[0];
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${type}`;
            logEntry.innerHTML = `<span class="log-time">[${timeString}]</span><span class="log-message ${type}">${message}</span>`;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }
        
        // 更新状态
        function updateStatus(connected) {
            isConnected = connected;
            statusDot.className = `status-dot ${connected ? 'connected' : ''}`;
            statusText.textContent = connected ? '已连接' : '未连接';
            connectButton.disabled = connected || !selectedDevice;
            disconnectButton.disabled = !connected;
            scanButton.disabled = connected;
            
            if (connected) {
                addLog(`已连接到设备: ${selectedDevice.name}`, 'success');
            } else {
                addLog('设备已断开连接', 'info');
            }
        }
        
        // 扫描设备
        scanButton.addEventListener('click', async () => {
            addLog('开始扫描蓝牙设备...', 'info');
            scanButton.classList.add('scanning');
            
            try {
                // 请求蓝牙设备
                selectedDevice = await navigator.bluetooth.requestDevice({
                    filters: [
                        { name: deviceName },
                        { services: ['heart_rate', 'battery_service'] } // 常见服务
                    ],
                    optionalServices: ['device_information', 'generic_access']
                });
                
                addLog(`找到设备: ${selectedDevice.name}`, 'success');
                connectButton.disabled = false;
                
                // 监听设备断开事件
                selectedDevice.addEventListener('gattserverdisconnected', () => {
                    updateStatus(false);
                });
                
            } catch (error) {
                addLog(`扫描失败: ${error.message}`, 'error');
            } finally {
                scanButton.classList.remove('scanning');
            }
        });
        
        // 连接设备
        connectButton.addEventListener('click', async () => {
            if (!selectedDevice) {
                addLog('未选择设备', 'error');
                return;
            }
            
            addLog(`正在连接设备: ${selectedDevice.name}`, 'info');
            
            try {
                // 连接到GATT服务器
                const server = await selectedDevice.gatt.connect();
                addLog('GATT服务器连接成功', 'success');
                
                // 获取设备信息服务
                const deviceInfoService = await server.getPrimaryService('device_information');
                addLog('设备信息服务获取成功', 'success');
                
                // 获取通用访问服务
                const genericAccessService = await server.getPrimaryService('generic_access');
                addLog('通用访问服务获取成功', 'success');
                
                // 更新状态
                updateStatus(true);
                
            } catch (error) {
                addLog(`连接失败: ${error.message}`, 'error');
            }
        });
        
        // 断开连接
        disconnectButton.addEventListener('click', () => {
            if (selectedDevice && selectedDevice.gatt.connected) {
                selectedDevice.gatt.disconnect();
                addLog('已断开设备连接', 'info');
            }
            updateStatus(false);
        });
        
        // 初始化日志
        addLog('页面已加载，点击"扫描设备"开始搜索您的小米手环6', 'info');
        addLog('注意: 此功能需要浏览器支持Web Bluetooth API', 'info');
        addLog('推荐使用Chrome、Edge或Opera浏览器', 'info');
    </script>
</body>
</html>
